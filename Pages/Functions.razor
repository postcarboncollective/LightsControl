@page "/"
@page "/Functions"
@using System.Timers
@implements IDisposable

<PageTitle>Functions</PageTitle>

<center>
    <br/>
    <MudContainer>
        <MudButton OnClick="@(() => ShowBlackoutPanel = !ShowBlackoutPanel)" EndIcon="@(ShowBlackoutPanel ? Icons.Material.Filled.ArrowUpward : Icons.Material.Filled.ArrowDownward)">
            Blackout
        </MudButton>
        @if (ShowBlackoutPanel)
        {
            <MudContainer Style="background: #111f">
                <br/>
                <MudGrid>
                    @foreach (var name in Enum.GetNames(typeof(Lights)))
                    {
                        <MudItem xs="6">
                            <MudSwitch UnCheckedColor="Color.Primary" Color="Color.Secondary" Label="@name" LabelPosition="LabelPosition.Start" @bind-Value="@Global.Blackout.Switch[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)].Value" Style="align-items: center"/>
                        </MudItem>
                    }
                </MudGrid>
                <br/>
            </MudContainer>
        }
    </MudContainer>
    <br/>
    <MudContainer>
        <MudButton OnClick="@(() => ShowExpulsadeiraPanel = !ShowExpulsadeiraPanel)" EndIcon="@(ShowExpulsadeiraPanel ? Icons.Material.Filled.ArrowUpward : Icons.Material.Filled.ArrowDownward)" Color="@(Global.Expulsadeira.Executing ? Color.Secondary : Color.Primary)">
            Expulsadeira
        </MudButton>
        @if (ShowExpulsadeiraPanel)
        {
            <MudContainer Style="background: #111f">
                <br/>
                <MudGrid>
                    @foreach (var name in Enum.GetNames(typeof(Lights)))
                    {
                        <MudItem xs="6">
                            <MudSwitch UnCheckedColor="Color.Primary" Color="Color.Secondary" Label="@name" LabelPosition="LabelPosition.Start" @bind-Value="@Global.Expulsadeira.Switch[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)].Value" Style="align-items: center"/>
                        </MudItem>
                    }
                    <MudItem xs="12" Class="d-flex justify-center">
                        <MudColorPicker @bind-Value="Global.Expulsadeira.Color.Value" DisableToolbar="@true" DisableAlpha="@true" DisableColorField="@false" DisablePreview="@false" DisableSliders="@false" DisableInputs="@true" DisableModeSwitch="@true" ColorPickerMode="ColorPickerMode.RGB" PickerVariant="PickerVariant.Static"/>
                    </MudItem>
                </MudGrid>
                <br/>
            </MudContainer>
        }
    </MudContainer>
    <br/>
    <MudContainer>
        <MudButton OnClick="@(() => ShowStrobePanel = !ShowStrobePanel)" EndIcon="@(ShowStrobePanel ? Icons.Material.Filled.ArrowUpward : Icons.Material.Filled.ArrowDownward)" Color="@(Global.Strobe.Executing ? Color.Secondary : Color.Primary)">
            Strobe
        </MudButton>
        @if (ShowStrobePanel)
        {
            <MudContainer Style="background: #111f">
                <br/>
                <MudGrid>
                    @foreach (var name in Enum.GetNames(typeof(Lights)))
                    {
                        <MudItem xs="6">
                            <MudSwitch UnCheckedColor="Color.Primary" Color="Color.Secondary" Label="@name" LabelPosition="LabelPosition.Start" @bind-Value="@Global.Strobe.Switch[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)].Value" Style="align-items: center"/>
                        </MudItem>
                    }
                    <MudItem xs="12" Class="d-flex justify-center">
                        <MudColorPicker @bind-Value="Global.Strobe.Color" DisableToolbar="@true" DisableAlpha="@true" DisableColorField="@false" DisablePreview="@false" DisableSliders="@false" DisableInputs="@true" DisableModeSwitch="@true" ColorPickerMode="ColorPickerMode.RGB" PickerVariant="PickerVariant.Static"/>
                    </MudItem>
                    <MudItem xs="12">
                        <MudSlider @bind-Value="Global.Strobe.Speed" Min="0.01" Max="0.99" Step="0.01">Speed</MudSlider>
                    </MudItem>
                    @foreach (var name in Enum.GetNames(typeof(Lights)))
                    {
                        <MudItem xs="6">
                            <MudText>@(name) @(Global.Strobe.Inverted[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)] ? "Inverted" : "Normal")</MudText>
                            <MudToggleIconButton @bind-Toggled="@Global.Strobe.Inverted[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)]" Icon="@Icons.Material.Filled.AlarmOff" Color="@Color.Error" ToggledIcon="@Icons.Material.Filled.AlarmOn" ToggledColor="@Color.Success"/>
                        </MudItem>
                    }
                </MudGrid>
                <br/>
            </MudContainer>
        }
    </MudContainer>
    <br/>
    <MudContainer>
        <MudButton OnClick="@(() => ShowOscillatorPanel = !ShowOscillatorPanel)" EndIcon="@(ShowOscillatorPanel ? Icons.Material.Filled.ArrowUpward : Icons.Material.Filled.ArrowDownward)" Color="@(Global.Oscillator.Executing ? Color.Secondary : Color.Primary)">
            Oscillator
        </MudButton>
        @if (ShowOscillatorPanel)
        {
            <MudContainer Style="background: #111f">
                <br/>
                <MudGrid>
                    @foreach (var name in Enum.GetNames(typeof(Lights)))
                    {
                        <MudItem xs="6">
                            <MudSwitch UnCheckedColor="Color.Primary" Color="Color.Secondary" Label="@name" LabelPosition="LabelPosition.Start" @bind-Value="@Global.Oscillator.Switch[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)].Value" Style="align-items: center"/>
                        </MudItem>
                    }
                    <MudItem xs="12" Class="d-flex justify-center">
                        <MudColorPicker @bind-Value="Global.Oscillator.Color" DisableToolbar="@true" DisableAlpha="@true" DisableColorField="@false" DisablePreview="@false" DisableSliders="@false" DisableInputs="@true" DisableModeSwitch="@true" ColorPickerMode="ColorPickerMode.RGB" PickerVariant="PickerVariant.Static"/>
                    </MudItem>
                    <MudItem xs="12">
                        <MudSlider @bind-Value="Global.Oscillator.Speed" Min="0.001" Max="0.249" Step="0.001">Speed</MudSlider>
                    </MudItem>
                    <MudItem xs="12">
                        <MudRadioGroup @bind-Value="Global.Oscillator.Type">
                            <MudRadio Value="1" Color="Color.Secondary" UnCheckedColor="Color.Primary">Sine</MudRadio>
                            <MudRadio Value="2" Color="Color.Secondary" UnCheckedColor="Color.Primary">Saw</MudRadio>
                            @* <MudRadio Value="3" Color="Color.Secondary" UnCheckedColor="Color.Primary">Log</MudRadio> *@
                            @* <MudRadio Value="4" Color="Color.Secondary" UnCheckedColor="Color.Primary">Four</MudRadio> *@
                        </MudRadioGroup>
                    </MudItem>
                    @foreach (var name in Enum.GetNames(typeof(Lights)))
                    {
                        <MudItem xs="6">
                            <MudText>@(name) @(Global.Oscillator.Inverted[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)] ? "Inverted" : "Normal")</MudText>
                            <MudToggleIconButton @bind-Toggled="@Global.Oscillator.Inverted[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)]" Icon="@Icons.Material.Filled.AlarmOff" Color="@Color.Error" ToggledIcon="@Icons.Material.Filled.AlarmOn" ToggledColor="@Color.Success"/>
                        </MudItem>
                    }
                </MudGrid>
                <br/>
            </MudContainer>
        }
    </MudContainer>
    <br/>
    <MudContainer>
        <MudButton OnClick="@(() => ShowSwitchPanel = !ShowSwitchPanel)" EndIcon="@(ShowSwitchPanel ? Icons.Material.Filled.ArrowUpward : Icons.Material.Filled.ArrowDownward)" Color="@(Global.Switch.Executing ? Color.Secondary : Color.Primary)">
            Switch
        </MudButton>
        @if (ShowSwitchPanel)
        {
            <MudContainer Style="background: #111f">
                <br/>
                <MudGrid>
                    @foreach (var name in Enum.GetNames(typeof(Lights)))
                    {
                        <MudItem xs="6">
                            <MudSwitch UnCheckedColor="Color.Primary" Color="Color.Secondary" Label="@name" LabelPosition="LabelPosition.Start" @bind-Value="@Global.Switch.Switch[Enum.GetNames(typeof(Lights)).ToList().IndexOf(name)].Value" Style="align-items: center"/>
                        </MudItem>
                    }
                    <MudItem xs="12" Class="d-flex justify-center">
                        <MudColorPicker @bind-Value="Global.Switch.Color" DisableToolbar="@true" DisableAlpha="@true" DisableColorField="@false" DisablePreview="@false" DisableSliders="@false" DisableInputs="@true" DisableModeSwitch="@true" ColorPickerMode="ColorPickerMode.RGB" PickerVariant="PickerVariant.Static"/>
                    </MudItem>
                    <MudItem xs="12">
                        <MudSlider @bind-Value="Global.Switch.Speed" Min="0.01" Max="0.99" Step="0.01">Speed</MudSlider>
                    </MudItem>
                </MudGrid>
                <br/>
            </MudContainer>
        }
    </MudContainer>
</center>

@code {
    [CascadingParameter] public MainLayout MainLayout { get; set; }
    public bool ShowBlackoutPanel = false;
    public bool ShowExpulsadeiraPanel = false;
    public bool ShowStrobePanel = false;
    public bool ShowOscillatorPanel = false;
    public bool ShowSwitchPanel = false;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        MainLayout.Timer.Elapsed += RefreshTimer;
    }

    public void RefreshTimer(object? sender, ElapsedEventArgs args)
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        MainLayout.Timer.Elapsed -= RefreshTimer;
    }

}